# Knowledge Graph

This document serves as a semantic network of concepts to understand the domain of the application.

## Core Domain: Indoor Cycling

### Hardware Connectivity
*   **Communication Protocols**:
    *   **BLE (Bluetooth Low Energy)**: Primary modern connection.
        *   *Services*: FTMS (Fitness Machine Service), CP (Cycling Power), CSC (Cycling Speed & Cadence), HR (Heart Rate).
    *   **ANT+**: Legacy/Robust connection.
        *   *Profiles*: FE-C (Fitness Equipment - Controls), PWR (Power), HR (Heart Rate).
*   **Device Types**:
    *   **Smart Trainer**: Can set resistance (Slope mode) or target power (ERG mode).
    *   **Power Meter**: Broadcasts watts.
    *   **HRM**: Broadcasts beats per minute.

### Physics Simulation
*   **Inputs**:
    *   *Rider*: Weight, position (CdA).
    *   *Bike*: Rolling resistance (Crr), Drivetrain loss.
    *   *Environment*: Grade (slope), Wind speed, Air density.
    *   *Input Power*: Watts generated by rider.
*   **Outputs**:
    *   *Speed*: Virtual speed calculated from power vs resistance.
    *   *Distance*: Accumulated speed over time.

### Structured Training (Workouts)
*   **Intensity**:
    *   Defined relative to **FTP** (Functional Threshold Power).
    *   Example: "120% FTP" means `1.2 * FTP`.
*   **Modes**:
    *   **ERG Mode**: Trainer enforces specific wattage regardless of cadence/gear.
    *   **Slope/Sim Mode**: Trainer sets a "grade" (e.g., 2%), rider shifts gears to generate power.
*   **Structure**:
    *   *Warmup*: Progression from low to moderate.
    *   *Interval*: High effort "On" period.
    *   *Rest*: Low effort "Off" period.
    *   *Cooldown*: Ramp down.

### Application Logic (The "Brain")
*   **Event Bus (`xf`)**: The central nervous system.
    *   `db:power`: Current power changed.
    *   `ui:start`: User clicked start.
    *   `ble:connected`: Device paired.
*   **Timer**: Validates state every second (roughly). Creates the "Tick".
*   **Recorder**: Captures the state at every "Tick" to the Activity file.

## Concept Map

```text
[User] --(configures)--> [Profile]
[Profile] --(determines)--> [Zones]
[Profile] --(scales)--> [Workout]

[Trainer] --(reports)--> [Power/Speed]
[Trainer] <--(accepts)-- [Target Power/Slope]

[Application] --(monitors)--> [Sensors]
[Application] --(calculates)--> [Virtual Physics]
[Application] --(paints)--> [Views]
```
